// ====================================================================
// GENERATOR & DATASOURCE
// ====================================================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ====================================================================
// MASTER TABLES
// ====================================================================

// ------------------------------
// Provinces
// ------------------------------
model province {
  province_id BigInt  @id @default(autoincrement())
  name_th     String?

  districts district[]
  plots     plot[]
}

// ------------------------------
// Districts
// ------------------------------
model district {
  district_id BigInt  @id @default(autoincrement())
  province_id BigInt?
  name_th     String?

  province province? @relation(fields: [province_id], references: [province_id])
  plots    plot[]
}

// ------------------------------
// Statuses (Plot / Farmbook Status Master)
// ------------------------------
model status {
  status_id   BigInt  @id @default(autoincrement())
  farmbook_id String? @db.VarChar(255)
  plot_id     String? @db.VarChar(255)
  added_at    String? @db.VarChar(255)
  name_th     String?
  description String?

  plot_status_links plot_status_link[]
}

// ------------------------------
// StatusReceivingTransaction
// ------------------------------
model status_receiving_transaction {
  status_receiving_id   BigInt  @id @default(autoincrement())
  status_receiving_name String?
  description           String?
}

// ------------------------------
// FarmBookType
// ------------------------------
model farmbook_type {
  farmbook_type_id BigInt  @id @default(autoincrement())
  name_th          String?
  description      String?

  farmbooks farmbook[]
}

// ====================================================================
// ENTITY TABLES
// ====================================================================

// ------------------------------
// Buyers
// ------------------------------
model buyer {
  buyer_id       BigInt   @id @default(autoincrement())
  buyer_name     String?
  license_number String?
  contact_person String?
  phone          String?
  address        String?
  province_id    BigInt?
  district_id    BigInt?
  subdistrict_id BigInt?
  created_at     DateTime @default(now())

  farmers                farmer[]
  vehicles               vehicle[]
  drivers                driver[]
  receiving_transactions receiving_transaction[]
  buyer_farmers          buyer_farmer[]
  vehicle_drivers        vehicle_driver[] // <— เพิ่มบรรทัดนี้!
}

// ------------------------------
// Farmer
// ------------------------------
model farmer {
  farmer_id      BigInt    @id @default(autoincrement())
  farmer_name    String?
  farmer_surname String?
  citizen_id     String?
  phone          String?
  buyer_id       BigInt?
  address        String?
  created_at     DateTime?
  updated_at     DateTime?

  buyer                  buyer?                  @relation(fields: [buyer_id], references: [buyer_id])
  plots                  plot[]
  farmbooks              farmbook[]
  buyer_links            buyer_farmer[]
  receiving_transactions receiving_transaction[]
}

// ------------------------------
// Plots
// ------------------------------
model plot {
  plot_id              BigInt    @id @default(autoincrement())
  farmer_id            BigInt?
  land_code            String?
  province_id          BigInt?
  district_id          BigInt?
  subdistrict_id       BigInt?
  land_document_id     BigInt?
  deed_type            String?
  area_rai             Int?
  area_ngan            Int?
  area_wah             Int?
  area_acre            Int?
  geometry_type        String?
  is_owned_before_2020 Boolean?
  created_at           DateTime?
  updated_at           DateTime?

  farmer   farmer?   @relation(fields: [farmer_id], references: [farmer_id])
  province province? @relation(fields: [province_id], references: [province_id])
  district district? @relation(fields: [district_id], references: [district_id])

  land_document land_document? @relation(fields: [land_document_id], references: [land_document_id])

  plot_documents         plot_document[]
  plot_geometry          plot_geometry[]
  farmbook_plots         farmbook_plot[]
  plot_status_links      plot_status_link[]
  receiving_transactions receiving_transaction[]
  validations            validations[]
}

// ------------------------------
// LandDocument
// ------------------------------
model land_document {
  land_document_id BigInt    @id @default(autoincrement())
  document_number  String?
  document_type    String?
  issued_date      DateTime?
  created_at       DateTime?

  plots plot[]
}

// ------------------------------
// Vehicle
// ------------------------------
model vehicle {
  vehicle_id   BigInt    @id @default(autoincrement())
  buyer_id     BigInt?
  plate_number String?
  vehicle_type String?
  brand        String?
  model        String?
  created_at   DateTime?

  buyer                  buyer?                  @relation(fields: [buyer_id], references: [buyer_id])
  receiving_transactions receiving_transaction[]
  vehicle_drivers        vehicle_driver[]
}

// ------------------------------
// Driver
// ------------------------------
model driver {
  driver_id      BigInt    @id @default(autoincrement())
  buyer_id       BigInt?
  driver_name    String?
  driver_surname String?
  license_number String?
  phone          String?
  created_at     DateTime?

  buyer                  buyer?                  @relation(fields: [buyer_id], references: [buyer_id])
  vehicle_drivers        vehicle_driver[]
  receiving_transactions receiving_transaction[]
}

// ====================================================================
// DOCUMENTS & GEOMETRY
// ====================================================================

// ------------------------------
// PlotDocuments
// ------------------------------
model plot_document {
  doc_id     BigInt    @id @default(autoincrement())
  plot_id    BigInt?
  file_name  String?
  file_type  String?
  file_url   String?
  created_at DateTime?

  plot plot? @relation(fields: [plot_id], references: [plot_id])
}

// ------------------------------
// PlotGeometry
// ------------------------------
model plot_geometry {
  geometry_id BigInt    @id @default(autoincrement())
  plot_id     BigInt?
  coordinates String?
  created_at  DateTime?

  plot plot? @relation(fields: [plot_id], references: [plot_id])
}

// ====================================================================
// FARMBOOK SYSTEM
// ====================================================================

// ------------------------------
// Farmbook
// ------------------------------
model farmbook {
  farmbook_id      BigInt    @id @default(autoincrement())
  farmer_id        BigInt?
  farmbook_type_id BigInt?
  farmbook_number  String?
  created_at       DateTime?

  farmer        farmer?        @relation(fields: [farmer_id], references: [farmer_id])
  farmbook_type farmbook_type? @relation(fields: [farmbook_type_id], references: [farmbook_type_id])

  farmbook_plots farmbook_plot[]
}

// ------------------------------
// FarmbookPlots
// ------------------------------
model farmbook_plot {
  farmbook_plot_id BigInt    @id @default(autoincrement())
  farmbook_id      BigInt?
  plot_id          BigInt?
  created_at       DateTime?

  farmbook farmbook? @relation(fields: [farmbook_id], references: [farmbook_id])
  plot     plot?     @relation(fields: [plot_id], references: [plot_id])
}

// ====================================================================
// TRANSACTIONS
// ====================================================================

// ------------------------------
// ReceivingTransaction
// ------------------------------
model receiving_transaction {
  transaction_id    BigInt    @id @default(autoincrement())
  transaction_date  DateTime?
  buyer_id          BigInt?
  farmer_id         BigInt?
  plot_id           BigInt?
  vehicle_id        BigInt?
  driver_id         BigInt?
  weight_raw        Float?
  weight_after_calc Float?
  quality_score     Float?
  created_at        DateTime?

  buyer   buyer?   @relation(fields: [buyer_id], references: [buyer_id])
  farmer  farmer?  @relation(fields: [farmer_id], references: [farmer_id])
  plot    plot?    @relation(fields: [plot_id], references: [plot_id])
  vehicle vehicle? @relation(fields: [vehicle_id], references: [vehicle_id])
  driver  driver?  @relation(fields: [driver_id], references: [driver_id])
}

// ====================================================================
// LINKING TABLES
// ====================================================================

// ------------------------------
// Buyer-Farmer Link
// ------------------------------
model buyer_farmer {
  buyer_farmer_id BigInt    @id @default(autoincrement())
  buyer_id        BigInt?
  farmer_id       BigInt?
  created_at      DateTime?

  buyer  buyer?  @relation(fields: [buyer_id], references: [buyer_id])
  farmer farmer? @relation(fields: [farmer_id], references: [farmer_id])
}

// ------------------------------
// VehicleDriver
// ------------------------------
model vehicle_driver {
  vehicle_driver_id BigInt    @id @default(autoincrement())
  vehicle_id        BigInt?
  driver_id         BigInt?
  buyer_id          BigInt?
  assigned_date     DateTime?
  released_date     DateTime?

  vehicle vehicle? @relation(fields: [vehicle_id], references: [vehicle_id])
  driver  driver?  @relation(fields: [driver_id], references: [driver_id])
  buyer   buyer?   @relation(fields: [buyer_id], references: [buyer_id])
}

// ------------------------------
// PlotStatusLinks
// ------------------------------
model plot_status_link {
  plot_id      BigInt
  status_id    BigInt
  status_value Int?

  plot   plot   @relation(fields: [plot_id], references: [plot_id])
  status status @relation(fields: [status_id], references: [status_id])

  @@id([plot_id, status_id])
}

// ------------------------------
// Validations
// ------------------------------
model validations {
  validation_id BigInt    @id @default(autoincrement())
  plot_id       BigInt?
  date          DateTime?
  result        String?
  officer       String?
  remark        String?

  plot plot? @relation(fields: [plot_id], references: [plot_id])
}
